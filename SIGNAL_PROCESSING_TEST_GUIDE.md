# 신호처리 테스트 페이지 사용 가이드

## 개요
신호처리 테스트 페이지는 강아지 심박 측정기의 신호처리 시스템을 테스트할 수 있는 페이지입니다.
정상/비정상 데이터 시나리오를 선택하여 신호처리 결과를 확인할 수 있습니다.

## 접근 방법

1. **개발 모드에서만 접근 가능**
   - Header의 "신호처리 테스트" 링크 클릭
   - 또는 직접 URL: `http://localhost:3000/signal-processing-test`

2. **필수 조건**
   - 백엔드 서버가 실행 중이어야 함 (`http://localhost:5000`)
   - Socket.IO 연결이 되어 있어야 함
   - 프론트엔드가 실행 중이어야 함

## 테스트 시나리오

### 1. 정상 데이터 테스트
- **목적**: 정상적인 PPG 신호로부터 정확한 HR 계산 확인
- **특징**: 
  - 낮은 노이즈 레벨 (5%)
  - 일정한 심박수 (약 80 bpm)
  - 높은 PI 값
- **예상 결과**: 
  - SQI > 0.7
  - PI > 0.6
  - 안정화된 HR이 정확하게 계산됨

### 2. 낮은 PI 테스트 (신호 약함)
- **목적**: 신호 품질이 낮을 때의 처리 확인
- **특징**:
  - 높은 노이즈 레벨 (30%)
  - 낮은 PI 값
  - 신호 약함
- **예상 결과**:
  - "신호 품질이 낮습니다" 메시지
  - HR 계산 불가 또는 신뢰도 낮음
  - 재부착 안내

### 3. 높은 노이즈 테스트
- **목적**: 노이즈가 많은 환경에서의 신호처리 확인
- **특징**:
  - 높은 노이즈 레벨 (20%)
  - 신호 불안정
- **예상 결과**:
  - SQI 감소
  - HR 계산은 가능하나 신뢰도 낮음

### 4. 불규칙 심박 테스트
- **목적**: 불규칙한 심박 패턴 처리 확인
- **특징**:
  - 중간 노이즈 레벨 (15%)
  - 변동이 있는 심박수
- **예상 결과**:
  - HR 계산 가능
  - 시간 연속성 검증 동작 확인

## 사용 방법

### 1. 테스트 시작
1. 원하는 시나리오 버튼 클릭
   - 예: "정상 데이터 테스트" 버튼
2. 테스트가 시작되면:
   - 상태가 "수집 중"으로 변경됨
   - 1초마다 테스트 데이터가 전송됨
   - 신호처리 결과가 실시간으로 표시됨

### 2. 결과 확인
- **신호처리 상태**: 정상/신뢰도 낮음/재부착 필요
- **안정화된 HR**: 신호처리를 통해 계산된 HR
- **원본 HR**: 장치에서 전달된 원본 HR (참고용)
- **SQI**: Signal Quality Index (0-1)
- **PI**: Perfusion Index
- **HR 그래프**: 시간에 따른 HR 변화

### 3. 테스트 중지
- "테스트 중지" 버튼 클릭
- 또는 다른 시나리오 버튼 클릭 (자동으로 이전 테스트 중지)

## 데이터 흐름

```
1. 프론트엔드 테스트 페이지
   ↓ (테스트 데이터 생성)
2. POST /telemetry/test API 호출
   ↓ (백엔드 큐에 추가)
3. TelemetryWorker가 큐에서 데이터 처리
   ↓ (신호처리 수행)
4. HeartRateProcessor가 HR 계산
   - PI 계산
   - HR 후보 생성 (4가지 방법)
   - SQI 계산
   - Weighted Median으로 최종 HR 결정
   - EWMA로 안정화
   ↓ (결과 브로드캐스트)
5. Socket.IO를 통해 프론트엔드로 전송
   ↓ (실시간 표시)
6. 테스트 페이지에 결과 표시
```

## 주의사항

1. **5초 윈도우**: HR 계산은 최소 5초의 데이터가 필요합니다
   - 처음 5초는 "데이터 수집 중..." 상태
   - 5초 후부터 HR 계산 시작

2. **Socket.IO 연결**: Socket.IO가 연결되지 않으면 결과를 받을 수 없습니다
   - 연결 상태 확인: 페이지 상단의 연결 상태 표시

3. **백엔드 서버**: 백엔드 서버가 실행 중이어야 합니다
   - API 엔드포인트: `http://localhost:5000/telemetry/test`
   - TelemetryWorker가 실행 중이어야 함

4. **CSV 저장**: 테스트 데이터도 CSV에 저장됩니다
   - 위치: `back/data/csv/TEST-00-00-00-00-00_YYYY-MM-DD.csv`
   - 원본 데이터만 저장됨 (신호처리 결과 아님)

## 문제 해결

### 테스트 데이터가 전송되지 않는 경우
1. 백엔드 서버가 실행 중인지 확인
2. 브라우저 콘솔에서 에러 메시지 확인
3. Network 탭에서 API 호출 확인

### 신호처리 결과가 표시되지 않는 경우
1. Socket.IO 연결 상태 확인
2. 브라우저 콘솔에서 TELEMETRY 이벤트 수신 확인
3. 백엔드 로그에서 TelemetryWorker 처리 확인

### HR이 계산되지 않는 경우
1. 최소 5초 이상 테스트 실행
2. PI 값 확인 (PI < 0.3이면 HR 계산 불가)
3. 신호 품질 확인 (노이즈 레벨이 너무 높으면 실패)

## 추가 정보

- **신호처리 알고리즘**: `back/utils/signalProcessor.js`
- **HR 프로세서**: `back/utils/heartRateProcessor.js`
- **TelemetryWorker**: `back/workers/telemetryWorker.js`
- **테스트 페이지**: `front/src/pages/SignalProcessingTest.js`

