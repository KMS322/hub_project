# 프로젝트 문제 분석 및 수정 계획

## 🔍 발견된 주요 문제점

### 1. 보안 문제 (Critical)

#### 1.1 JWT_SECRET 환경변수 검증 누락
**위치**: `back/middlewares/auth.js`, `back/routes/auth.js`, `back/socket/index.js`
**문제**: `process.env.JWT_SECRET`이 없을 때 에러가 발생하거나 예측 가능한 기본값 사용
**영향**: JWT 토큰 위조 가능성
**수정 필요**: 서버 시작 시 JWT_SECRET 존재 여부 확인

#### 1.2 경로 조작 (Path Traversal) 취약점
**위치**: `back/routes/csv.js` - `/download` 엔드포인트
**문제**: `path.normalize()`만으로는 충분하지 않음. Windows 경로 구분자(`\`) 처리 필요
**영향**: 다른 사용자의 파일 접근 가능
**현재 보호**: `fullPath.startsWith(root)` 체크 있음 (양호)
**개선 필요**: 절대 경로 체크 강화

#### 1.3 입력 검증 부족
**위치**: 여러 라우트
**문제**: 
- MAC 주소 형식 검증 없음
- 파일명 검증 부족
- 숫자 입력 범위 검증 없음
**영향**: 잘못된 데이터 저장, 시스템 오류

### 2. 에러 처리 문제 (High)

#### 2.1 에러 핸들러 누락
**위치**: `back/server.js`
**문제**: 전역 에러 핸들러가 없음
**영향**: 처리되지 않은 에러로 인한 서버 크래시

#### 2.2 비동기 에러 처리 불완전
**위치**: 여러 라우트
**문제**: `async/await` 사용 시 `try-catch` 누락 가능성
**영향**: 에러가 처리되지 않아 서버 불안정

#### 2.3 Socket.IO 에러 처리
**위치**: `back/socket/index.js`
**문제**: Socket 이벤트 핸들러에서 에러 발생 시 클라이언트에 알림 없음
**영향**: 사용자가 에러를 인지하지 못함

### 3. 메모리 누수 및 리소스 관리 (High)

#### 3.1 타이머 정리 누락
**위치**: `front/src/pages/Hardware.js`
**문제**: `setTimeout`, `setInterval` 정리가 불완전할 수 있음
**영향**: 메모리 누수, 성능 저하

#### 3.2 Socket.IO 리스너 중복 등록
**위치**: `front/src/hooks/useSocket.js`, `front/src/services/socketService.js`
**문제**: 컴포넌트 재렌더링 시 리스너 중복 등록 가능성
**영향**: 메모리 누수, 중복 이벤트 처리

#### 3.3 Telemetry 큐 무한 증가
**위치**: `back/workers/telemetryWorker.js`
**문제**: 큐 처리 속도가 수신 속도보다 느리면 큐가 무한 증가
**영향**: 메모리 부족으로 서버 크래시

### 4. 동시성 문제 (Medium)

#### 4.1 Race Condition
**위치**: 여러 라우트
**문제**: 동시 요청 시 데이터 일관성 문제 가능성
**영향**: 데이터 불일치

#### 4.2 데이터베이스 트랜잭션 부족
**위치**: 여러 라우트
**문제**: 여러 DB 작업이 원자적으로 처리되지 않음
**영향**: 데이터 불일치

### 5. 성능 문제 (Medium)

#### 5.1 N+1 쿼리 문제
**위치**: `back/routes/device.js`, `back/routes/csv.js`
**문제**: 루프 내에서 DB 쿼리 실행
**영향**: 느린 응답 시간

#### 5.2 파일 I/O 동기 처리
**위치**: `back/routes/csv.js`
**문제**: `fs.readFileSync`, `fs.readdirSync` 사용
**영향**: 요청 블로킹, 느린 응답

### 6. 데이터 무결성 (Medium)

#### 6.1 입력 검증 부족
**위치**: 여러 라우트
**문제**: 필수 필드, 데이터 타입, 범위 검증 부족
**영향**: 잘못된 데이터 저장

#### 6.2 외래키 제약조건
**위치**: 데이터베이스 모델
**문제**: 외래키 제약조건이 없을 수 있음
**영향**: 고아 레코드 생성

### 7. 파일 시스템 작업 (Medium)

#### 7.1 디스크 공간 체크 없음
**위치**: `back/utils/csvWriter.js`
**문제**: 디스크 공간 부족 시 에러 처리 없음
**영향**: 파일 저장 실패

#### 7.2 파일 권한 체크 없음
**위치**: `back/routes/csv.js`
**문제**: 파일 읽기/쓰기 권한 체크 없음
**영향**: 권한 오류 발생 가능

## 📋 수정 우선순위

### Critical (즉시 수정)
1. JWT_SECRET 환경변수 검증
2. 경로 조작 취약점 강화
3. 전역 에러 핸들러 추가
4. Telemetry 큐 크기 제한

### High (빠른 시일 내 수정)
5. Socket.IO 리스너 중복 방지
6. 타이머 정리 보완
7. 비동기 에러 처리 보완
8. 입력 검증 강화

### Medium (계획적 수정)
9. N+1 쿼리 최적화
10. 파일 I/O 비동기화
11. 트랜잭션 추가
12. 디스크 공간 체크

## 🔧 수정 방법

각 문제에 대해 상세한 수정 코드를 제공하겠습니다.


