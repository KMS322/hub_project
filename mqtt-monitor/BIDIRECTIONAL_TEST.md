# MQTT Monitor β†” Backend μ–‘λ°©ν–¥ ν…μ¤νΈ κ°€μ΄λ“

MQTT Monitorμ™€ Backend μ„λ²„ κ°„μ μ–‘λ°©ν–¥ ν†µμ‹ μ„ ν…μ¤νΈν•λ” λ°©λ²•μ…λ‹λ‹¤.

## π€ μ‹μ‘ν•κΈ°

### 1. μ„λ²„ μ‹¤ν–‰

**ν„°λ―Έλ„ 1: λ°±μ—”λ“ μ„λ²„**
```bash
cd back
npm run dev
```

**ν„°λ―Έλ„ 2: MQTT λ¨λ‹ν„° μ„λ²„**
```bash
cd mqtt-monitor
npm start
```

**ν„°λ―Έλ„ 3: MQTT λΈλ΅μ»¤ (Mosquitto)**
```bash
# μ΄λ―Έ μ‹¤ν–‰ μ¤‘μ΄μ–΄μ•Ό ν•¨
mosquitto -v
```

### 2. μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†

1. MQTT Monitor: `http://localhost:3001`
2. Backend API: `http://localhost:5000`

## π“‹ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

### μ‹λ‚λ¦¬μ¤ 1: Monitor β†’ Backend

**λ©μ :** MQTT Monitorμ—μ„ λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•κ³  λ°±μ—”λ“κ°€ μμ‹ ν•λ”μ§€ ν™•μΈ

**μ‹¤ν–‰ λ°©λ²•:**
1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "μ–‘λ°©ν–¥ ν…μ¤νΈ μ‹¤ν–‰" λ²„νΌ ν΄λ¦­
3. "μ‹λ‚λ¦¬μ¤ 1: Monitor β†’ Backend" ν΄λ¦­
4. λ°±μ—”λ“ ν„°λ―Έλ„μ—μ„ λ©”μ‹μ§€ μμ‹  ν™•μΈ

**μμƒ κ²°κ³Ό:**
- λ°±μ—”λ“ ν„°λ―Έλ„μ— λ©”μ‹μ§€ μμ‹  λ΅κ·Έ μ¶λ ¥
- MQTT Monitorμ— λ°ν–‰λ λ©”μ‹μ§€ ν‘μ‹

### μ‹λ‚λ¦¬μ¤ 2: Backend β†’ Monitor

**λ©μ :** λ°±μ—”λ“ APIλ¥Ό ν†µν•΄ λ©”μ‹μ§€λ¥Ό λ°ν–‰ν•κ³  Monitorκ°€ μμ‹ ν•λ”μ§€ ν™•μΈ

**μ‹¤ν–‰ λ°©λ²•:**
1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "μ–‘λ°©ν–¥ ν…μ¤νΈ μ‹¤ν–‰" λ²„νΌ ν΄λ¦­
3. "μ‹λ‚λ¦¬μ¤ 2: Backend β†’ Monitor" ν΄λ¦­
4. MQTT Monitorμ—μ„ λ©”μ‹μ§€ μμ‹  ν™•μΈ

**μμƒ κ²°κ³Ό:**
- MQTT Monitorμ— μμ‹  λ©”μ‹μ§€ ν‘μ‹
- λ°±μ—”λ“ ν„°λ―Έλ„μ— λ°ν–‰ λ΅κ·Έ μ¶λ ¥

### μ‹λ‚λ¦¬μ¤ 3: ν—λΈ μƒνƒ μ‹λ®¬λ μ΄μ…

**λ©μ :** ν—λΈκ°€ λ°±μ—”λ“μ— μƒνƒλ¥Ό μ „μ†΅ν•λ” μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

**μ‹¤ν–‰ λ°©λ²•:**
1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "μ–‘λ°©ν–¥ ν…μ¤νΈ μ‹¤ν–‰" λ²„νΌ ν΄λ¦­
3. "μ‹λ‚λ¦¬μ¤ 3: ν—λΈ μƒνƒ μ‹λ®¬λ μ΄μ…" ν΄λ¦­

**μμƒ κ²°κ³Ό:**
- λ°±μ—”λ“μ—μ„ ν—λΈ μƒνƒλ΅ μ²λ¦¬
- `handleHubStatus` ν•¨μ μ‹¤ν–‰
- Socket.IOλ΅ ν”„λ΅ νΈμ—”λ“μ— μ „μ†΅ (ν”„λ΅ νΈκ°€ μ—°κ²°λμ–΄ μλ” κ²½μ°)

### μ‹λ‚λ¦¬μ¤ 4: λ…λ Ή-μ‘λ‹µ RPC

**λ©μ :** λ°±μ—”λ“κ°€ λ…λ Ήμ„ λ³΄λ‚΄κ³  Monitorκ°€ μ‘λ‹µν•λ” RPC νλ¦„ ν…μ¤νΈ

**μ‹¤ν–‰ λ°©λ²•:**
1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "μ–‘λ°©ν–¥ ν…μ¤νΈ μ‹¤ν–‰" λ²„νΌ ν΄λ¦­
3. "μ‹λ‚λ¦¬μ¤ 4: λ…λ Ή-μ‘λ‹µ RPC" ν΄λ¦­
4. μλ™μΌλ΅ μ‘λ‹µμ΄ λ°ν–‰λ¨ (1μ΄ ν›„)

**μμƒ κ²°κ³Ό:**
- λ°±μ—”λ“μ—μ„ λ…λ Ή λ°ν–‰
- Monitorμ—μ„ μ‘λ‹µ λ°ν–‰
- λ°±μ—”λ“μ—μ„ μ‘λ‹µ μμ‹  λ° μ²λ¦¬
- `pendingCommands` Mapμ—μ„ requestId λ§¤μΉ­

### μ‹λ‚λ¦¬μ¤ 5: Telemetry λ°μ΄ν„°

**λ©μ :** ν—λΈκ°€ Telemetry λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ

**μ‹¤ν–‰ λ°©λ²•:**
1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "μ–‘λ°©ν–¥ ν…μ¤νΈ μ‹¤ν–‰" λ²„νΌ ν΄λ¦­
3. "μ‹λ‚λ¦¬μ¤ 5: Telemetry λ°μ΄ν„°" ν΄λ¦­

**μμƒ κ²°κ³Ό:**
- λ°±μ—”λ“μ—μ„ Telemetry λ°μ΄ν„°λ΅ μ²λ¦¬
- `handleTelemetry` ν•¨μ μ‹¤ν–‰
- Telemetry Workerμ—μ„ νμ— μ¶”κ°€
- λ°μ΄ν„°λ² μ΄μ¤ μ €μ¥ (μ„¤μ •λ κ²½μ°)
- CSV νμΌ μ €μ¥

## π”§ μλ™ ν…μ¤νΈ

### Monitorμ—μ„ μ§μ ‘ λ°ν–‰

1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "λ°ν–‰ μ„μΉ"λ¥Ό "MQTT Monitorμ—μ„ μ§μ ‘" μ„ νƒ
3. ν† ν”½κ³Ό λ©”μ‹μ§€ μ…λ ¥
4. "λ°ν–‰" λ²„νΌ ν΄λ¦­

### Backend APIλ¥Ό ν†µν•΄ λ°ν–‰

1. MQTT Monitor μ›Ή μΈν„°νμ΄μ¤ μ ‘μ†
2. "λ°ν–‰ μ„μΉ"λ¥Ό "λ°±μ—”λ“ APIλ¥Ό ν†µν•΄" μ„ νƒ
3. λ°±μ—”λ“ URL ν™•μΈ (κΈ°λ³Έ: `http://localhost:5000`)
4. ν† ν”½κ³Ό λ©”μ‹μ§€ μ…λ ¥
5. "λ°ν–‰" λ²„νΌ ν΄λ¦­

λλ” curl μ‚¬μ©:
```bash
curl -X POST http://localhost:5000/mqtt-test/publish \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "test/topic",
    "message": {"test": "value"},
    "qos": 1,
    "retain": false
  }'
```

## π“ ν™•μΈ λ°©λ²•

### λ°±μ—”λ“ ν„°λ―Έλ„ λ΅κ·Έ

```
[MQTT Client] π“¥ Message received
  Topic: test/topic
  Size: 25 bytes
  Payload preview: {"test":"value"}
  β… Parsed as JSON successfully

[MQTT Service] π” Debug - Received from test/topic
  Message: { test: 'value' }
```

### MQTT Monitor μ›Ή μΈν„°νμ΄μ¤

- λ©”μ‹μ§€ λ΅κ·Έμ— μ‹¤μ‹κ°„μΌλ΅ ν‘μ‹
- ν†µκ³„ μ •λ³΄ μ—…λ°μ΄νΈ
- ν† ν”½λ³„ ν•„ν„°λ§ κ°€λ¥

### λ°±μ—”λ“ API μ‘λ‹µ

```json
{
  "success": true,
  "message": "λ©”μ‹μ§€κ°€ λ°ν–‰λμ—μµλ‹λ‹¤.",
  "data": {
    "topic": "test/topic",
    "message": {"test": "value"},
    "qos": 1,
    "retain": false,
    "timestamp": "2024-12-03T14:31:56.789Z"
  }
}
```

## π› λ¬Έμ  ν•΄κ²°

### λ°±μ—”λ“μ—μ„ λ©”μ‹μ§€κ°€ μ• λ³΄μ΄λ” κ²½μ°

1. **λ°±μ—”λ“ μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈ**
   ```bash
   # ν¬νΈ ν™•μΈ
   netstat -ano | findstr :5000  # Windows
   ```

2. **κ°λ° λ¨λ“μΈμ§€ ν™•μΈ**
   - `.env` νμΌμ—μ„ `NODE_ENV=development` ν™•μΈ
   - λ°±μ—”λ“ μ„λ²„ μ¬μ‹μ‘

3. **MQTT λΈλ΅μ»¤ μ—°κ²° ν™•μΈ**
   - λ°±μ—”λ“ ν„°λ―Έλ„μ—μ„ `[MQTT] Connected to broker` λ©”μ‹μ§€ ν™•μΈ

### Monitorμ—μ„ λ©”μ‹μ§€κ°€ μ• λ³΄μ΄λ” κ²½μ°

1. **Monitor μ„λ²„κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈ**
   ```bash
   # ν¬νΈ ν™•μΈ
   netstat -ano | findstr :3001  # Windows
   ```

2. **MQTT λΈλ΅μ»¤ μ—°κ²° ν™•μΈ**
   - Monitor μ„λ²„ ν„°λ―Έλ„μ—μ„ μ—°κ²° λ©”μ‹μ§€ ν™•μΈ

3. **λΈλΌμ°μ € μ½μ†” ν™•μΈ**
   - F12λ΅ κ°λ°μ λ„κµ¬ μ—΄κΈ°
   - Console νƒ­μ—μ„ μ—λ¬ ν™•μΈ

### API νΈμ¶ μ‹¤ν¨

1. **CORS μ„¤μ • ν™•μΈ**
   - λ°±μ—”λ“μ CORS μ„¤μ •μ΄ Monitor URLμ„ ν—μ©ν•λ”μ§€ ν™•μΈ

2. **λ°±μ—”λ“ URL ν™•μΈ**
   - Monitor μ›Ή μΈν„°νμ΄μ¤μ "λ°±μ—”λ“ URL" ν•„λ“ ν™•μΈ
   - κΈ°λ³Έκ°’: `http://localhost:5000`

3. **λ„¤νΈμ›ν¬ μ—°κ²° ν™•μΈ**
   - λΈλΌμ°μ €μ—μ„ μ§μ ‘ `http://localhost:5000/mqtt-test/status` μ ‘μ† ν…μ¤νΈ

## π’΅ ν

1. **μ—¬λ¬ ν„°λ―Έλ„ μ‚¬μ©**
   - ν„°λ―Έλ„ 1: λ°±μ—”λ“ μ„λ²„
   - ν„°λ―Έλ„ 2: MQTT λ¨λ‹ν„° μ„λ²„
   - ν„°λ―Έλ„ 3: MQTT λΈλ΅μ»¤ (Mosquitto)
   - ν„°λ―Έλ„ 4: curl ν…μ¤νΈ (μ„ νƒ)

2. **λ΅κ·Έ ν•„ν„°λ§**
   - λ°±μ—”λ“ ν„°λ―Έλ„μ—μ„ νΉμ • ν† ν”½λ§ λ³΄λ ¤λ©΄ ν•„ν„° μ‚¬μ©
   - Monitor μ›Ή μΈν„°νμ΄μ¤μ—μ„ ν† ν”½ ν•„ν„° μ‚¬μ©

3. **μλ™ ν…μ¤νΈ**
   - μ‹λ‚λ¦¬μ¤ λ²„νΌμ„ μ‚¬μ©ν•λ©΄ μλ™μΌλ΅ ν…μ¤νΈ μ‹¤ν–‰
   - μλ™μΌλ΅λ„ ν† ν”½κ³Ό λ©”μ‹μ§€λ¥Ό μ§μ ‘ μ…λ ¥ κ°€λ¥

4. **μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§**
   - Monitor μ›Ή μΈν„°νμ΄μ¤λ¥Ό μ—΄μ–΄λ‘λ©΄ μ‹¤μ‹κ°„μΌλ΅ λ¨λ“  λ©”μ‹μ§€ ν™•μΈ κ°€λ¥
   - λ°±μ—”λ“ ν„°λ―Έλ„λ„ ν•¨κ» ν™•μΈν•λ©΄ μ–‘λ°©ν–¥ ν†µμ‹  ν™•μΈ κ°€λ¥

